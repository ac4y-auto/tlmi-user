var Ac4yStateMachineAlgebra=require("@ac4y/ac4y-common/algebra/Ac4yStateMachineAlgebra.js");
var Ac4yStateMachineConstant=require("@ac4y/ac4y-common/constant/Ac4yStateMachineConstant.js");

var Ac4yStateSetList=require("@ac4y/ac4y-common/state/Ac4yStateSetList.js");
var Ac4yStateSet=require("@ac4y/ac4y-common/state/Ac4yStateSet.js");
var Ac4yStepList=require("@ac4y/ac4y-common/state/Ac4yStepList.js");
var Ac4yStep=require("@ac4y/ac4y-common/state/Ac4yStep.js");

var Ac4yObjectHandler=require("@ac4y/ac4y-common/utility/Ac4yObjectHandler.js");

class Ac4yStateMachine extends Ac4yStateMachineAlgebra {

    constructor(object) {

        super(object);

        //this.createTransitionList();

        if (!this.hasStateSetList()) this.createStateSetList();
        if (!this.hasStepList()) this.createStepList();
        if (!this.hasState()) this.born();

    } // constructor

    createSelf(object) {return new Ac4yStateMachine(object);}

    forPersistence(){

        var object = this.createSelf(this);
        
        object.check();

        object = new Ac4yObjectHandler().deleteObjectTypeProperties(object);

//        console.log(object);

        return object;

    } // forPersistence 
    
    setState(aState){ 

        super.setState(aState);

        if (!this.hasStateSetList()) this.createStateSetList();

        this.getStateSetList().addStateSet(aState);

    } // setState 

    born(){this.setState(new Ac4yStateMachineConstant().BORN);}
    death(){this.setState(new Ac4yStateMachineConstant().DEATH);}

    isLive(){return this.getState()!=new Ac4yStateMachineConstant().DEATH;}

    recreateStateSetList(){this.clearStateSetList(); this.createStateSetList();}

    hasReachedThisState(aState){return this.getStateSetList().hasReachedThisState(aState);}

    getShortInformationObjectOfStateSetList(){

        return this.getStateSetList().get().map(
                 function(aStateSet){
                     return new Ac4yStateSet().getNewFromObject(aStateSet).getShortInformationObject();
                 }
         );

    } // getShortInformationObjectOfStateSetList

} // Ac4yStateMachine

module.exports=Ac4yStateMachine
